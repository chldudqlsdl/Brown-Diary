# **MVVM ì•„í‚¤í…ì²˜ ì„¤ëª… (MVVMì´ë¡ ê³¼ ì½”ë“œ) (ì—…ë°ì´íŠ¸-5ê°•)**

<aside>
ğŸ’¡ **ViewModel**

- **Model âˆ™ Output âˆ™ Input âˆ™ Logic**
</aside>

### MVVM

- VM(ViewModel) â†’ ë·°ë¥¼ ìœ„í•œ ëª¨ë¸ì„ ê°€ì§„ë‹¤
    - ë·°ì™€ ëª¨ë¸ ì‚¬ì´ì— í•˜ë‚˜ì˜ ê³„ì¸µì„ ì¶”ê°€

### MVC ì™€ ë¹„êµ

- MVC ëŠ” Controller ê°€ Model ê³¼ Viewë¥¼ ì†Œìœ í•˜ëŠ” í˜•íƒœ
- MVVM
    - View + Controller = View
    - View ê°€ Model ì„ ê°€ì§„ë‹¤
    - í•˜ì§€ë§Œ View ì™€ Model ì‚¬ì´ì— ViewModel ì´ë¼ëŠ” ê³„ì¸µì´ ë‘˜ì„ ì—°ê²°í•œë‹¤

### ì½”ë“œ

- VM ì€ ì¼ë°˜ì ìœ¼ë¡œ í´ë˜ìŠ¤ë¡œ ë§Œë“ ë‹¤
    - Observable
- ë·°ì»¨ì€ VM ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì§€ê³  VM ì—ë‹¤ê°€ ê³„ì† ìš”ì²­í•œë‹¤
- ë·°ì»¨ì´ ê°€ì§€ê³  ìˆë˜ ë°ì´í„° ëª¨ë¸ì„ VM ìœ¼ë¡œ ì˜®ê¸´ë‹¤
    - ì•„ì›ƒí’‹ë„ ë°”ë¡œ ì“¸ ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ (ê³„ì‚°ì†ì„± âˆ™ ë©”ì„œë“œë„ ê°€ëŠ¥)
    
    ```swift
    class MusicViewModel {
    
        // í•µì‹¬ ë°ì´í„°(ëª¨ë¸) â­ï¸â­ï¸â­ï¸ (ë·°ëª¨ë¸ì´ ê°€ì§€ê³  ìˆìŒ)
        var music: Music? {
            didSet {
                onCompleted(music)
            }
        }
        
        // ë·°ë¥¼ ìœ„í•œ ë°ì´í„° (Output)
        var albumNameString: String? {
            return music?.albumName
        }
    }
    ```
    
- ë·°ì»¨ì´ ê°€ì§€ê³  ìˆë˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ VM ìœ¼ë¡œ ì˜®ê¸´ë‹¤
- **didSet : ì‹œì ì„ ì•Œë ¤ì£¼ëŠ” ìš©ë„**
    
    ```swift
    class MusicViewModel {
        
        // í•µì‹¬ ë°ì´í„°(ëª¨ë¸) â­ï¸â­ï¸â­ï¸ (ë·°ëª¨ë¸ì´ ê°€ì§€ê³  ìˆìŒ)
        var music: Music? {
            didSet {
                onCompleted(music)
            }
        }
        
        var onCompleted: (Music?) -> Void = { _ in }
    }
    
    class ViewController: UIViewController {
    
        @IBOutlet weak var albumNameLabel: UILabel!
        
        var viewModel: MusicViewModel!
        
        override func viewDidLoad() {
            super.viewDidLoad()
            // ë·°ëª¨ë¸ì— ì ‘ê·¼í•˜ê¸° ì „ì— ë¬´ì¡°ê±´ í•„ìš” (ìƒì„±)
            self.viewModel = MusicViewModel()
            
            // ë°ì´í„° ë³€ê²½ì´ ì™„ë£Œëœ í›„, í´ë¡œì €ì—ì„œ ì–´ë–¤ ì¼ì„ í• ì§€ ì •ì˜ (í• ë‹¹)
            self.viewModel.onCompleted = { [weak self] _ in
                DispatchQueue.main.async {
                    self?.albumNameLabel.text = self?.viewModel.albumNameString
                }
            }
        }
    }
    ```
    
# **MVVM ì•„í‚¤í…ì²˜ ì„¤ëª… (í™”ë©´ì´ë™) (ì—…ë°ì´íŠ¸-6ê°•)**

### ì´ë¡ 

- VM : ë°ì´í„°ë¥¼ ì™„ì „íˆ ë·°ë¥¼ ìœ„í•œ í˜•íƒœë¡œ ë§Œë“¤ì–´ë³´ì â†’ 1 : 1 ë§¤ì¹­
- VM ì—ì„œ ë°˜ì‘í˜•ìœ¼ë¡œ ì „ë‹¬í•˜ë©´ ê·¸ê²Œ Rx? â†’ ë°˜ì‘í˜• í”„ë¡œê·¸ë˜ë°

- **í™”ë©´ì´ë™ì€ ì–´ë–»ê²Œ í•˜ì§€? - MainView â†’ DetailView**
    - MainVM ì—ì„œ DetailVM ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•œë‹¤
    
    ```swift
        @IBAction func nextButtonTapped(_ sender: UIButton) {
            
            guard viewModel.music != nil else { return }
            
            // ì›ì¹™ ========================================
            //ë‹¤ìŒ í™”ë©´ì˜ ë·°ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ê°€ì ¸ì•¼ í•˜ëŠ” ë·°ëª¨ë¸ â­ï¸
            let detailVM = DetailViewModel()
            
            //ë·°ëª¨ë¸ì´ ê°€ì ¸ì•¼ í•˜ëŠ” ë°ì´í„° â­ï¸
            detailVM.music = viewModel.music
            detailVM.imageURL = viewModel.music?.imageUrl
            
            // ì¼ë°˜ì ìœ¼ë¡œ ====================================
            //let detailVM = viewModel.getDetailViewModel()
            
            //ë‹¤ìŒ í™”ë©´ ë·°ì»¨íŠ¸ë¡¤ëŸ¬ â­ï¸
            let detailVC = storyboard?.instantiateViewController(withIdentifier: "detailVC") as! DetailViewController
            //ë·°ëª¨ë¸ ì „ë‹¬ â­ï¸ (ë·°ë””ë“œë¡œë“œê°€ í˜¸ì¶œë˜ê¸° ì „ì— ì „ë‹¬)
            detailVC.viewModel = detailVM
            
            detailVC.modalPresentationStyle = .fullScreen
            self.present(detailVC, animated: true)
        }
    ```
    
    - ì¼ë°˜ì ìœ¼ë¡œëŠ” ì´ëŸ° íŒ¨í„´ ì‚¬ìš©
    
    ```swift
        func getDetailViewModel() -> DetailViewModel {
            let detailVM = DetailViewModel()
    
            detailVM.music = self.music
            detailVM.imageURL = self.music?.imageUrl
    
            return detailVM
        }
    ```
    
# **MVVM ì•„í‚¤í…ì²˜ ì„¤ëª… (ì˜ì¡´ì„± ì£¼ì… í™œìš©) (ì—…ë°ì´íŠ¸-7-1ê°•)**

### í”„ë¡œí† ì½œ ì„ ì–¸

```swift
protocol NetworkType {
    func fetchMusic(completion: @escaping (Result<[Music], NetworkError>) -> Void)
    func loadImage(imageURL: String?, completion: @escaping (UIImage?) -> Void)
}
```

### í´ë˜ìŠ¤ì— í”„ë¡œí† ì½œ ì±„íƒ

```swift
class APIService: NetworkType {
    func fetchMusic(completion: @escaping (Result<[Music], NetworkError>) -> Void) {
    }
}
```

### ì˜ì¡´ì„± ì£¼ì…

```swift
class MusicViewModel {
    
    // ì¼ë¶€ëŸ¬ ì‹±ê¸€í†¤ìœ¼ë¡œ ì•ˆ ë§Œë“¦
    let apiManager: NetworkType
    
    // ì˜ì¡´ì„± ì£¼ì… â­ï¸â­ï¸â­ï¸
    init(apiManager: NetworkType) {
        self.apiManager = apiManager
    }
}
```

### ì´ˆê¸°í™”

```swift
class SceneDelegate: UIResponder, UIWindowSceneDelegate {

    var window: UIWindow?

    func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) {
        // ìŠ¤í† ë¦¬ë³´ë“œ ìƒì„± + ì¡°ê±´ì„ ë§Œë“¤ì–´ì„œ ì½”ë“œë¡œ ìƒì„±í•˜ê¸° â­ï¸â­ï¸â­ï¸
        guard let windowScene = (scene as? UIWindowScene) else { return }
        window = UIWindow(windowScene: windowScene)
        
        let storyboard = UIStoryboard(name: "Main", bundle: nil)
        
        // ë„¤íŠ¸ì›Œí‚¹ ê°ì²´ ìƒì„±
        let apiService = APIService()
        
        // ì˜ì¡´ì„± ì£¼ì…ë°©ì‹ìœ¼ë¡œ ë„¤íŠ¸ì›Œí‚¹ ê°ì²´ ì „ë‹¬ â­ï¸â­ï¸â­ï¸ (ë·°ëª¨ë¸ ìƒì„±)
        let musicVM = MusicViewModel(apiManager: apiService)

        let firstVC = storyboard.instantiateViewController(withIdentifier: "ViewController") as! ViewController
        
        // ë·°ëª¨ë¸ ì „ë‹¬
        firstVC.viewModel = musicVM
        
        window?.rootViewController = firstVC
        window?.makeKeyAndVisible()
    }
}
```

# BMIì•± - 1 (MVVMìœ¼ë¡œ ë°”ê¾¸ê¸°) (ì—…ë°ì´íŠ¸-10ê°•)

### ìƒì„±ìê°€ ìˆëŠ” ë·°ì»¨íŠ¸ë¡¤ëŸ¬ ì´ë™

```swift
class SecondViewController: UIViewController {

    // ì „í™”ë©´ì—ì„œ ì „ë‹¬ë°›ì€ BMIë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ë³€ìˆ˜
    var viewModel: BMIViewModel
    
    // (ìŠ¤í† ë¦¬ë³´ë“œ) ì»¤ìŠ¤í…€ ìƒì„±ì â­ï¸â­ï¸â­ï¸
    init(coder: NSCoder, viewModel: BMIViewModel) {
        self.viewModel = viewModel
        super.init(coder: coder)!
    }
}

private func goToNextVC(storyBoard: UIStoryboard?, fromCurrentVC: UIViewController, animated: Bool) {
    
    // ìŠ¤í† ë¦¬ë³´ë“œ ìƒì„± + ì»¤ìŠ¤í…€ ìƒì„±ì â­ï¸â­ï¸â­ï¸
    guard let secondVC = storyBoard?
        .instantiateViewController(identifier: "SecondViewController", creator: { coder in
            SecondViewController(coder: coder, viewModel: self) })
    else {}
    
    secondVC.modalPresentationStyle = .fullScreen
    fromCurrentVC.present(secondVC, animated: true, completion: nil)
}
```

# **ë°”ì¸ë”© ê°œë… (ì—…ë°ì´íŠ¸-14 âˆ™ 15ê°•)**

### ë°”ì¸ë”© : ë°ì´í„°ê°€ ë°”ë€Œë©´ ê·¸ì— ë”°ë¼ UI ë„ ë°”ë€Œì–´ì•¼ í•œë‹¤

- ê¸°ì¡´ì—ëŠ” didSet + í´ë¡œì €ë¡œ ì´ë¥¼ êµ¬í˜„

### ì—¬ëŸ¬ê°€ì§€ ë°”ì¸ë”© ë°©ë²•

- ë¸ë¦¬ê²Œì´íŠ¸ íŒ¨í„´
- í´ë¡œì €(í•¨ìˆ˜í˜¸ì¶œ) - didSet
- ì†ì„±ê°ì‹œì(Box ë°©ì‹) - í´ë˜ìŠ¤ë¡œ ê°ì‹¸ì§„ ë°ì´í„°
- ë°˜ì‘í˜• í”„ë¡œê·¸ë˜ë° (RxSwift âˆ™ Combine)

### ì†ì„±ê°ì‹œì(Box ë°©ì‹) - í´ë˜ìŠ¤ë¡œ ê°ì‹¸ì§„ ë°ì´í„° â†’ RxSwift

- didSet ì´ í´ë˜ìŠ¤ ì†ìœ¼ë¡œ ë“¤ì–´ê°„ ê²ƒ ë¿ì¸ê°€?
- Observable

```swift
class í´ë˜ìŠ¤ë¡œê°ì‹¸ì§„ë°ì´í„°<T> {
    
    // ê°’ì´ ë³€í• ë•Œë§ˆë‹¤ "ë‚˜ì¤‘ì—í˜¸ì¶œë ìˆ˜ìˆëŠ”í•¨ìˆ˜"(í´ë¡œì €/í•¨ìˆ˜) í˜¸ì¶œ
    var ë°ì´í„°ê°’: T {
        didSet {
            ë‚˜ì¤‘ì—í˜¸ì¶œë ìˆ˜ìˆëŠ”í•¨ìˆ˜?(ë°ì´í„°ê°’)
        }
    }
    
    // "ë°ì´í„°ê°’"ì´ ë³€í• ë•Œ =====> í•¨ìˆ˜í˜¸ì¶œ â­ï¸â­ï¸â­ï¸
    var ë‚˜ì¤‘ì—í˜¸ì¶œë ìˆ˜ìˆëŠ”í•¨ìˆ˜: ((T) -> Void)?
    
    init(_ ê°’: T) {
        self.ë°ì´í„°ê°’ = ê°’
    }
    
    func ë°”ì¸ë”©í•˜ê¸°(ì½œë°±í•¨ìˆ˜: @escaping (T) -> Void) {
        self.ë‚˜ì¤‘ì—í˜¸ì¶œë ìˆ˜ìˆëŠ”í•¨ìˆ˜ = ì½œë°±í•¨ìˆ˜
    }

}
```

- ViewModel

```swift
//class MusicViewModel
var music: í´ë˜ìŠ¤ë¡œê°ì‹¸ì§„ë°ì´í„°<Music> = 
        í´ë˜ìŠ¤ë¡œê°ì‹¸ì§„ë°ì´í„°(Music(songName: nil, artistName: nil, albumName: nil, imageUrl: nil))
```

- View

```swift
//class ViewController
self.viewModel.music.ë°”ì¸ë”©í•˜ê¸° { [weak self] music in
    DispatchQueue.main.async {
        self?.albumNameLabel.text = music.albumName
        self?.songNameLabel.text = music.songName
        self?.artistNameLabel.text = music.artistName
    }
}
```

d
