# RxSwift ë¥¼ ë°°ìš°ëŠ” ì´ìœ 

### ê¸°ë³¸ì½”ë“œ

- ì½”ë“œê°€ ë™ê¸°ì (ì•ì— ì½”ë“œê°€ ëë‚˜ëŠ” ê²ƒì„ ê¸°ë‹¤ë¦°ë‹¤) ìœ¼ë¡œ ì§„í–‰ë˜ë¯€ë¡œ ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì„ í•˜ë©´ ë‹¤ë¥¸ ì‘ì—…ì´ ë‹¤ ë©ˆì¶˜ë‹¤ ( íƒ€ì´ë¨¸ âˆ™ ì• ë‹ˆë©”ì´ì…˜)

```swift
@IBAction func onLoad() {
    editView.text = ""
    setVisibleWithAnimation(activityIndicator, true)

    let url = URL(string: MEMBER_LIST_URL)!
    let data = try! Data(contentsOf: url)
    let json = String(data: data, encoding: .utf8)
    self.editView.text = json
    
    self.setVisibleWithAnimation(self.activityIndicator, false)
}
```

### ë¹„ë™ê¸°ì²˜ë¦¬

- `DispatchQueue.global().async` â†’ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì‘ì—… ì²˜ë¦¬í•´ì£¼ê³  ê²°ê³¼ê°’ì„ ë°›ì•„ì„œ
- completion ì— ë„£ì–´ì¤€ë‹¤ â†’ UI ë³€ê²½ ì½”ë“œë‹ˆê¹Œ
- ë¹„ë™ê¸°ì²˜ë¦¬ ì½”ë“œ ë‚´ë¶€ì—ì„œëŠ” ì›ë˜ëŒ€ë¡œ ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ê±° ì•Œì§€?

```swift
func downloadJson(_ url: String, _ completion: @escaping (String?) -> Void) {
    DispatchQueue.global().async {
        let url = URL(string: MEMBER_LIST_URL)!
        let data = try! Data(contentsOf: url)
        let json = String(data: data, encoding: .utf8)
        DispatchQueue.main.async {
            completion(json)
        }
    }
}
@IBAction func onLoad() {
    editView.text = ""
    setVisibleWithAnimation(activityIndicator, true)

    downloadJson(MEMBER_LIST_URL) { json in
        self.editView.text = json
        self.setVisibleWithAnimation(self.activityIndicator, false)
    }
}
```

### ê·¼ë° ë‚˜ëŠ” ì»´í”Œë¦¬ì…˜ í•¸ë“¤ëŸ¬ë¥¼ ì“°ê¸° ì‹«ì€ë°? + ìŠ¤íŠ¸ë¦¬íŠ¸íŒŒì´í„°ì´ë¯¸ì§€(ì½œë°±ì§€ì˜¥)

```swift
class ë‚˜ì¤‘ì—ìƒê¸°ëŠ”ë°ì´í„°<T> {
    private let task: (@escaping (T) -> Void) -> Void
    
    init(task: @escaping (@escaping (T) -> Void) -> Void) {
        self.task = task
    }
    
    func ë‚˜ì¤‘ì—ìƒê¸°ë©´ (_ f: @escaping (T) -> Void) {
        task(f)
    }
}

func downloadJson(_ url: String) -> ë‚˜ì¤‘ì—ìƒê¸°ëŠ”ë°ì´í„°<String?> {
    
    return ë‚˜ì¤‘ì—ìƒê¸°ëŠ”ë°ì´í„° { f in
        DispatchQueue.global().async {
            let url = URL(string: MEMBER_LIST_URL)!
            let data = try! Data(contentsOf: url)
            let json = String(data: data, encoding: .utf8)
            DispatchQueue.main.async {
                f(json)
            }
        }
    }
}

@IBAction func onLoad() {
    editView.text = ""
    setVisibleWithAnimation(activityIndicator, true)
    
    let json: ë‚˜ì¤‘ì—ìƒê¸°ëŠ”ë°ì´í„°<String?> = downloadJson(MEMBER_LIST_URL)
    
    json.ë‚˜ì¤‘ì—ìƒê¸°ë©´ { json in
        self.editView.text = json
        self.setVisibleWithAnimation(self.activityIndicator, false)
    }
}
```

### RxSwift

- **ë‚˜ì¤‘ì— ìƒê¸°ëŠ” ë°ì´í„°(Class) â†’ Observable**
- **ë‚˜ì¤‘ì— ìƒê¸°ë©´(method) â†’ subscribe**

```swift
class Observable<T> {
    private let task: (@escaping (T) -> Void) -> Void
    
    init(task: @escaping (@escaping (T) -> Void) -> Void) {
        self.task = task
    }
    
    func subscribe (_ f: @escaping (T) -> Void) {
        task(f)
    }
}

func downloadJson(_ url: String) -> Observable<String?> {
    
    return Observable { f in
        DispatchQueue.global().async {
            let url = URL(string: MEMBER_LIST_URL)!
            let data = try! Data(contentsOf: url)
            let json = String(data: data, encoding: .utf8)
            DispatchQueue.main.async {
                f(json)
            }
        }
    }
}

@IBAction func onLoad() {
    editView.text = ""
    setVisibleWithAnimation(activityIndicator, true)
    
    let json: Observable<String?> = downloadJson(MEMBER_LIST_URL)
    
    json.subscribe { json in
        self.editView.text = json
        self.setVisibleWithAnimation(self.activityIndicator, false)
    }
}
```

### Disposable

```swift
class Disposable {}

class Observable<T> {
    private let task: (@escaping (T) -> Void) -> Disposable
    
    init(task: @escaping (@escaping (T) -> Void) -> Disposable) {
        self.task = task
    }
    
    func subscribe (_ f: @escaping (T) -> Void) -> Disposable {
        task(f)
    }
}

func downloadJson(_ url: String) -> Observable<String?> {
    
    return Observable { f in
        DispatchQueue.global().async {
            let url = URL(string: MEMBER_LIST_URL)!
            let data = try! Data(contentsOf: url)
            let json = String(data: data, encoding: .utf8)
            DispatchQueue.main.async {
                f(json)
            }
        }
        return Disposable()
    }
}

@IBAction func onLoad() {
    editView.text = ""
    setVisibleWithAnimation(activityIndicator, true)
    
    let json: Observable<String?> = downloadJson(MEMBER_LIST_URL)
    
    json.subscribe { json in
        self.editView.text = json
        self.setVisibleWithAnimation(self.activityIndicator, false)
    }
}
```

# RxSwift ì˜ ê¸°ë³¸ í˜•íƒœ

### ê¸°ë³¸ í˜•íƒœ

- ë¹„ë™ê¸°ì²˜ë¦¬í•  í•¨ìˆ˜ë¥¼ í™œìš©í•´  `Observable` ì„ ë§Œë“¤ ê²ƒ
- `Observable` ì¸ìŠ¤í„´ìŠ¤ ìƒì„±í•˜ëŠ” ìŠ¤íƒœí‹± ë©”ì„œë“œëŠ” `.create()`
    
    ```swift
    public static func create(_ subscribe: @escaping (AnyObserver<Element>) -> Disposable) -> Observable<Element>
    ```
    
    - í´ë¡œì € `{ Observer(f)ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ Disposable ì„ ë¦¬í„´}` ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ Observable ì„ ë¦¬í„´í•œë‹¤ (ì•„ë˜ì˜ init ì—­í• )
    - Observer : ê¸°ì¡´ì˜ ì»´í”Œë¦¬ì…˜ í•¸ë“¤ëŸ¬
    - ë¹„ë™ê¸° ì²˜ë¦¬ í•¨ìˆ˜ ëŒë ¤ì„œ ì–»ì€ ê°’ì€ `.onNext()` ë¡œ Observer ì— ì „ë‹¬
- `Observable` ê³¼ `Observer` ì–´ë–»ê²Œ ì—°ê²°í•˜ë‚˜ìš”? â†’ `subscribe()`
    - Observable ì— subscribe() ë©”ì„œë“œë¥¼ ë¶™ì´ë©´(ì‹¤í–‰í•˜ë©´)
        - ë¹„ë™ê¸°ì²˜ë¦¬ í•¨ìˆ˜ê°€ ëŒì•„ê°€ê¸° ì‹œì‘í•˜ì—¬ ìœ„ì—ì„œ ë§í•œ ëª¨ë“  ì‘ì—…ì´ ì‹œì‘
    - event ëŠ” next âˆ™ error âˆ™completed ì˜ ì„¸ê°€ì§€ ì¼€ì´ìŠ¤ë¡œ ë‚˜ë‰˜ëŠ”ë°, ë„˜ê²¨ì¤„ ë•Œë„ ê°ê° ë”°ë¡œ ë„˜ê²¨ì¤€ë‹¤
        - ex)   `.onNext()`

```swift
// ëŒ€ëµ ì´ëŸ° í˜•íƒœ
class Observable<T> {
    private let task: (@escaping (T) -> Void) -> Disposable
    
    init(task: @escaping (@escaping (T) -> Void) -> Disposable) {
        self.task = task
    }
    
    // f ê°€ Observer
    func subscribe (_ f: @escaping (T) -> Void) -> Disposable {
        task(f)
    }
}
```

```swift
func downloadJson(_ url: String) -> **Observable<String?>** {
    
    return **Observable.create()** { f in
        DispatchQueue.global().async {
            let json = String(data: data, encoding: .utf8)
            DispatchQueue.main.async {
                **f.onNext(json)**
            }
        }
        **return Disposables.create()**
    }
}

@IBAction func onLoad() {
    
    let json: Observable<String?> = downloadJson(MEMBER_LIST_URL)
    
    **json.subscribe** { event in
        switch event {
        **case .next(let json):**
            self.editView.text = json
        **case .error(_): break
        case .completed: break**
        }
    }
}
```

### dispose

- disposable ë¥¼ ì·¨ì†Œì‹œí‚¤ëŠ” ë©”ì„œë“œ

```swift
let disposable = json.subscribe { event in
    switch event {
    case .next(let json):
        self.editView.text = json
        self.setVisibleWithAnimation(self.activityIndicator, false)
    case .error(_): break
    case.completed: break
    }
}

disposable.dispose()
```

# RxSwift ì™€ ìˆœí™˜ì°¸ì¡°

### ìˆœí™˜ì°¸ì¡° :**Observable ê³¼ Disposable ê°„ ìˆœí™˜ì°¸ì¡°ê°€ ë°œìƒí•˜ë¯€ë¡œ ì´ ì‚¬ì´ë¥¼ ëŠì–´ì¤˜ì•¼ í•¨**

- `.onCompleted()`
- `.onError()`
- `Disposable.dispose()` â†’ subscribe ê°€ í•´ì œë˜ê¸°ì— ë¹„ë™ê¸°ì²˜ë¦¬ê°€ ë°”ë¡œ ë©ˆì¶˜ë‹¤!

```swift
func downloadJson(_ url: String) -> Observable<String?> {
    
    return Observable.create() { f in
        DispatchQueue.global().async {
            let json = String(data: data, encoding: .utf8)
            DispatchQueue.main.async {
                f.onNext(json)
            }
        }
        return Disposables.create()
    }
}

@IBAction func onLoad() {
    
    let json: Observable<String?> = downloadJson(MEMBER_LIST_URL)
    
    json.subscribe { event in
        switch event {
        case .next(let json):
            self.editView.text = json
        case .error(_): break
        case .completed: break
        }
    }
}
```

### DeepDive

- ì•„ì§ ë§ì´ í—·ê°ˆë¦¬ë‹ˆ ì´ê²ƒë§Œ í™•ì‹¤í•˜ê²Œ í•˜ì
- **Observable ê³¼ Disposable ì‚¬ì´ì—ì„œ ìˆœí™˜ì°¸ì¡°ê°€ ë°œìƒí•œë‹¤**
    - Disposable ì´ Observable ì°¸ì¡°í•˜ëŠ” ê²ƒì€ ë‹¹ì—°í•˜ê³ 
    - Observable ì´ Disposable ì°¸ì¡°í•˜ëŠ” ê²ƒì€ ë‚´ë¶€ ì‚¬ì •?

# Observable

<aside>
ğŸ’¡ ìƒëª…ì£¼ê¸° íŒŒì•…í•˜ë ¤ë©´ â†’ `debug()`

</aside>

### ìƒëª…ì£¼ê¸°

- **Create**
- **Subcribe**
- **onNext**
- **onCompleted / onError â†’ Debug í•´ë³´ë©´ onCompleted ì´ ë¶ˆë¦¬ë©´ ìë™ìœ¼ë¡œ Disposed ë¨**
- **Disposed**

### ì •ë¦¬ëœ í˜•íƒœ

```swift
func downloadJson(_ url: String) -> Observable<String?> {
                
        Observable.create { emitter in
            emitter.onNext("Hello")
            emitter.onCompleted()
            return Disposables.create()
        }
 }
```

### í™œìš© - URLSession

- onError âˆ™onNext âˆ™onCompleted ìë¦¬ í™•ì¸
- **Disposables.create ë’¤ì˜ í´ë¡œì €ëŠ” dispose ë˜ë©´ ë¶ˆë¦°ë‹¤**
    - onCompleted ê°€ ë¶ˆë¦¬ë©´ ìë™ìœ¼ë¡œ disposed ê°€ ë¶ˆë¦¼

```swift
func downloadJson(_ url: String) -> Observable<String?> {
    
    Observable.create { emitter in
        let url = URL(string: MEMBER_LIST_URL)!
        let task = URLSession.shared.dataTask(with: url) { data, response, err in
            guard err == nil else {
                emitter.onError(err!)
                return
            }
            if let data = data {
                let json = String(data: data, encoding: .utf8)
                emitter.onNext(json)
            }
            // ìœ„ì— ë¦¬í„´ì´ ì—†ìœ¼ë‹ˆ ì–˜ëŠ” ë¬´ì¡°ê±´ ë¶ˆë¦¼
            emitter.onCompleted()
        }
        task.resume()
        
        return Disposables.create {
            task.cancel()
        }
    }
}
```

# subscribe

```swift
let observable: Observable<String?> = downloadJson(MEMBER_LIST_URL)

let disposable = observable.subscribe { event in
    switch event {
    case .next(let json):
        DispatchQueue.main.async {
            self.editView.text = json
            self.setVisibleWithAnimation(self.activityIndicator, false)
        }
    case .error(let err):
        print(err.localizedDescription)
    case .completed: break
    }
}

//disposable.dispose()
```

# Sugar APIs

### ê¸°ì¡´ì˜ ë°©ì‹

```swift
Observable.create { emitter in
    emitter.onNext("Hello World")
    return Disposables.create()
}
```

### Just

```swift
Observable.just("Hello")
```

### From : ë°°ì—´ë¡œ í•˜ë‚˜ì”©

```swift
Observable.from(["Hello", "World"])
```

### subscribe ë¶„ê¸°ì²˜ë¦¬ ê·€ì°®ì•„ìš”

- Just ë‚˜ From ì€ ìë™ìœ¼ë¡œ completed í˜¸ì¶œí•´ì£¼ëŠ” ë“¯?

```swift
.subscribe(onNext: { print($0) }, onCompleted: { print("Com?") })
```

# Operator

### **.observeOn - ìŠ¤ë ˆë“œ ë³€ê²½**

```swift
_ = downloadJson(url: MEMBER_LIST_URL)
    .observeOn(MainScheduler.instance)
    .subscribe(onNext: { [weak self] json in
        self?.editView.text = json
        self?.setVisibleWithAnimation(self?.activityIndicator, false)
    })
```

### .map

### .filter

