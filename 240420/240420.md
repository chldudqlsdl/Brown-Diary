# **46. User Tweet Database Structure**

<aside>
ğŸ’¡ **ê¸°ì¡´ì˜ DB ì—ì„œëŠ” íŠ¹ì • ì‚¬ìš©ìê°€ ì‘ì„±í•œ íŠ¸ìœ—ì„ ë³´ë ¤ë©´ ëª¨ë“  íŠ¸ìœ—ì„ íƒìƒ‰í•´ì„œ í•´ë‹¹ íŠ¸ìœ—ì„ ëˆ„ê°€ ì‘ì„±í–ˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•˜ëŠ”ë° â†’ ì• ì´ˆì— íŠ¸ìœ—ì„ DB ì— ì €ì¥í•  ë•Œ ì‚¬ìš©ìë³„ë¡œë„ ì €ì¥í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?**

</aside>

### íŠ¸ìœ— ì €ì¥ì‹œ Tweet Key ë¥¼ ì‚¬ìš©ìë³„ë¡œ ì €ì¥

```swift
// Constants
let REF_USER_TWEETS = DB_REF.child("user-tweets")

// TweetService
func uploadTweet(caption: String, completion: @escaping ( Error?, DatabaseReference) -> Void) {
    guard let uid = Auth.auth().currentUser?.uid else { return }
    
    let values = ["uid": uid,
                  "timestamp": Int(NSDate().timeIntervalSince1970),
                  "likes": 0,
                  "retweets": 0,
                  "caption": caption] as [String : Any]
    
    REF_TWEETS.childByAutoId().updateChildValues(values) { err, ref in
        guard let tweetID = ref.key else { return }
        REF_USER_TWEETS.child(uid).updateChildValues([tweetID: 1], withCompletionBlock: completion)
    }
}
```

# **47. Fetching User Tweets**

<aside>
ğŸ’¡ **ë©”ì„œë“œ ì˜¤ë²„ë¡œë”© :** ë©”ì„œë“œëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ë‹¤ë¥´ê²Œ ì¨ì£¼ë©´ ì•„ì˜ˆ ë‹¤ë¥¸ ë©”ì„œë“œê°€ ëœë‹¤

</aside>

### fetchTweets by user from user-tweet

- userë¥¼ íˆ¬ì…í•˜ë©´ uidë¥¼ ì´ìš©í•´ì„œ í•´ë‹¹ uid ì˜ user-tweet ë¥¼ ë‹¤ ê°€ì ¸ì˜¤ê³ 
- user-tweet ì˜ key ì¸ tweetID ë¥¼ ê°€ì ¸ì™€ í•´ë‹¹ tweetID ì˜ tweet ì„ ê°€ì ¸ì˜¨ë‹¤!

```swift
func fetchTweets(forUser user: User, completion: @escaping ([Tweet]) -> Void) {
    var tweets : [Tweet] = []
    REF_USER_TWEETS.child(user.uid).observe(.childAdded) { snapshot in
        let tweetID = snapshot.key
        REF_TWEETS.child(tweetID).observeSingleEvent(of: .value) { snapshot in
            guard let dictionary = snapshot.value as? [String: Any] else { return }
            let tweet = Tweet(tweetID: tweetID, dictionary: dictionary, user: user)
            tweets.append(tweet)
            completion(tweets)
        }
    }
}
```

### ProfileControllerì˜ ë³€ìˆ˜ [Tweet] ì—ë‹¤ê°€ ê²°ê³¼ ì €ì¥í•˜ê³  ìš”ê±¸ë¡œ collectionView êµ¬ì„±
