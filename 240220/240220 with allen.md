# 동시성(Concurrency) 프로그래밍 (173강)

<aside>
💡 **앱은 1초에 60번 화면 업데이트 → 메인쓰레드가 이를 담당하기에 네트워크 작업을 수행하면 화면 버벅 거림 → 다른 쓰레드로 분산을 해줘야 함 → 작업을 큐에만 던져주면 OS가 알아서 분산 → 이 큐가 바로 DispatchQueue**

</aside>

## 비동기 처리를 해야하는 이유

### CPU

- 1코어 1쓰레드 → 2코어 2쓰레드 → 4코어 4쓰레드 → 8코어 16쓰레드
- **쓰레드는 물리적인 계산기**
- 물리적 쓰레드와 소프트웨어적 쓰레드는 다르지만 일단 넘어간다

### 앱의 동작원리(메인 쓰레드의 역할)

- 앱에 동작 발생 → Port 로 프로세스 식별 → 이벤트 형태로 전환 → **메인 런루프(반복문)에서 이벤트 핸들링** → 필요한 함수 찾아서 실행 → 업데이트 사이클(화면 표시)

**핵심**

- 앱이 시작될 때 메인 런 루프가 생김
- 이벤트 처리를 담당 → 어떤 함수를 실행시킬지 선택/ 실행
- **함수 실행 결과를 화면에 업데이트** ← **이것을 메인 쓰레드가 수행한다**
    - **메인 쓰레드는 1초에 60번 화면을 업데이트 해야한다 → 하청을 시키긴 함**
    - **화면 그리는 역할이 있으니, 너무 오래 걸리는 작업을 시키면 화면이 버벅거린다**

### 동시성 처리

- 메인쓰레드의 작업을 다른 쓰레드로 분산시키자!
- **작업을 큐(대기행렬)에 보내기만 하면, iOS(운영체제)가 여러 쓰레드로 나눠서 분산처리를 한다**

### 큐

- 큐에 작업이 배치되면, 쓰레드를 만든다 (작업을 쌓아놓고 배치하는게 아니라, 들어오면 바로바로 분산)
- 그림에는 쓰레드가 미리 그려져 있지만, 실제로는 쓰레드는 생성되었다가 사라진다

### DispatchQueue

- 대기열은 두가지가 있지만 우리는 **DispatchQueue** 만 다룬다
- 우리는 직접적으로 쓰레드를 관리하지 않고, 큐를 이용하면 OS 가 분산처리를 해준다 → 더 높은 차원
- 네트워크 처리 같은 작업이 쉽게 비동기적으로 동작하도록 함

### 병렬 vs 동시

- 물리적인 쓰레드와 소프트웨어적인 쓰레드는 일대일 매칭이 아니다
- OS는 물리적인 쓰레드를 여러개의 소프트웨어적 쓰레드로 분산시킨다(소프트웨어 쓰레드는 수십개도 가능)
- **병렬(Parallel) : 물리적인 쓰레드에서 동시에(여러 쓰레드로 나눠서) 일을 하는 개념**
- **동시(Concurrency) : 소프트웨어적인 쓰레드에서 동시에(여러 쓰레드로 나눠서) 일을 하는 개념**
- 한개의 물리적인 쓰레드 위에 여러개의 쓰레드 객체가 일을 하면 → 병렬은 아니지만, 동시는 맞다
- **우리는 소프트웨어적인 동시성 처리만 신경쓰면 된다 ⇒ 최적화**

# 동기 비동기의 개념 (174강)

### 비동기 vs 동기

전제 : 한 쓰레드에서 다른 쓰레드로 작업을 보낸다

**비동기 : 보낸 작업이 끝날 때 까지 기다리지 않는다**

**동기 : 보낸 작업이 끝날 때 까지 기다린다**

### Blocking vs Non - Blocking

CPU 제어권 여부와 관련된 개념

비동기 : 다른 메서드에 작업을 넘기고, 바로 제어권을 반환 → **제어권 Non-Blocking**

동기 : 다른 메서드에 작업을 넘기고, 그 작업이 끝날 때까지 기다렸다 제어권을 반환 → **제어권 Block**

### Swift에서 동기는 Blocking , 비동기는 Non-Blocking의 개념으로만 사용

# 동기 비동기의 개념 (174강)

### 비동기 vs 동기

전제 : 한 쓰레드에서 다른 쓰레드로 작업을 보낸다

**비동기 : 보낸 작업이 끝날 때 까지 기다리지 않는다**

**동기 : 보낸 작업이 끝날 때 까지 기다린다**

### Blocking vs Non - Blocking

CPU 제어권 여부와 관련된 개념

비동기 : 다른 메서드에 작업을 넘기고, 바로 제어권을 반환 → **제어권 Non-Blocking**

동기 : 다른 메서드에 작업을 넘기고, 그 작업이 끝날 때까지 기다렸다 제어권을 반환 → **제어권 Block**

### Swift에서 동기는 Blocking , 비동기는 Non-Blocking의 개념으로만 사용

# GCD의 개념 및 종류 (176강)

### 메인큐(1번 쓰레드)

```swift
let mainQueue = DispatchQueue.main
```

- **직렬(순서대로)**
- UI업데이트

### 글로벌큐 ∙ Qos

```swift
let defaultQueue = DispatchQueue.global()
```

- **동시(Concurrent)**
- **6종류의 Qos(Quality of service) 를 설정 가능**
    - 우선순위가 높은 Qos 는 많은 쓰레드를 사용하고, CPU 배터리를 많이 사용해 일을 빨리 끝낸다
- .userInteractive ∙ .userInitiated ∙  .utility ∙ .background ∙ .unspecified
- 일반적으로는 .default 사용

### 프라이빗 큐

```swift
let privateQueue = DispatchQueue(label: "com.inflearn.serial")
```

- **기본설정은 직렬**
- Qos 설정가능, Attribute 설정하면 동시도 가능
