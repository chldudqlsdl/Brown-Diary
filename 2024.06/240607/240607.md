# WebView Advanced

<aside>
ğŸ’¡ ì¸ìŠ¤íƒ€ê·¸ë¨ ë²„íŠ¼ì„ í´ë¦­í•œ ë’¤, ë„¤ì´ë²„ ì§€ë„ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì¸ìŠ¤íƒ€ ê·¸ë¨ í™”ë©´ì´ ë– ìˆë‹¤ê°€ ë„¤ì´ë²„ ì§€ë„ í™”ë©´ìœ¼ë¡œ ë°”ë€ŒëŠ” ìƒí™© ë°œìƒ

</aside>

### ê³„ì† ìƒˆ ì›¹ë·°ë¡œ ê°ˆì•„ì£¼ì

- webView ë¥¼ ê°ˆì•„ì£¼ê¸° ë•Œë¬¸ì— ì¸ë””ì¼€ì´í„°ê°€ ì‚¬ë¼ì§
- Indicator ë ˆì´ì•„ì›ƒë„ ê³„ì† ë°”ê¿”ì£¼ê¸°
- ë™ì‹œì— delegate ë„ ë§¤ë²ˆ ë°”ê¿”ì¤˜ì•¼í•¨

```swift
func configureWebView() {
    self.webView = WKWebView()
    self.layoutIndicator()
    self.webView.navigationDelegate = self
    self.loadingIndicator.startAnimating()
}

func layoutIndicator() {
    webView.addSubview(loadingIndicator)
    loadingIndicator.snp.makeConstraints {
        $0.centerX.centerY.equalToSuperview()
    }
}
```

# ë‚˜ì™€ ì˜í™”ê´€ì˜ ê±°ë¦¬ ì¸¡ì •

### IndieCinema ëª¨ë¸ ë³€ê²½

- í”„ë¡œí¼í‹° ì¶”ê°€

```swift
struct IndieCinema: Hashable {
    var distance: Double = 0
}
```

### CinemaViewModel ë³€ê²½

- ê±°ë¦¬ê°€ í¬í•¨ëœ ì˜í™”ê´€ ë¦¬ìŠ¤íŠ¸(cinemasWithDistance) ë¥¼ ë§Œë“¤ ë•Œ ë§¤ê°œë³€ìˆ˜ cinema ì˜ ê°’ì„ ì§ì ‘ ë³€ê²½í•˜ëŠ” ê²ƒì€ ë¶ˆê°€í•´ì„œ ì´ë¥¼ updatedCinema ë¡œ
- **ì›ë˜ í´ë¡œì €ì˜ íŒŒë¼ë¯¸í„°ëŠ” ë¶ˆë³€ì´ë‹¤!**

```swift
fetchNearCinemas
    .do(onNext: { [weak self] _ in self?.isLoading.onNext(true) })
    .withLatestFrom(self.currentCoordinate)
    .map { currentCoordinate in
        let cinemasWithDistance = IndieCinema.list.map { cinema -> IndieCinema in
            var updatedCinema = cinema
            updatedCinema.distance = updatedCinema.coordinate.distance(to: currentCoordinate)
            return updatedCinema
        }
        let sortedCinemaListByDistance = cinemasWithDistance.sorted { cinema1, cinema2 in
            let distance1 = currentCoordinate.distance(to: cinema1.coordinate)
            let distance2 = currentCoordinate.distance(to: cinema2.coordinate)
            return distance1 < distance2
        }
        return Array(sortedCinemaListByDistance.prefix(3))
    }
    .bind(to: nearCinemas)
    .disposed(by: disposeBag)
```

# ì¢Œí‘œ ì—…ë°ì´íŠ¸

### ì´ë™ê±°ë¦¬ì— ë”°ë¥¸ ì¢Œí‘œ ì—…ë°ì´íŠ¸

- flatMap ì„ í•œë²ˆ íƒ”ê¸° ë•Œë¬¸ì— 1ì´ˆì— í•œë²ˆì”© ë³€ê²½ëœ ì¢Œí‘œ ê°’ì´ ì „ë‹¬ë˜ëŠ” ì¤‘
    - ê¸°ì¡´ì—ëŠ” take(1) ìœ¼ë¡œ ì´ë¥¼ ì–µì œí–ˆì—ˆìŒ
- withLatestFrom ìœ¼ë¡œ í˜„ì¬ í™”ë©´ì„ ì—…ë°ì´íŠ¸ í•œ ì¢Œí‘œê°’(oldCoordinate)ì„ ë°›ì•„ì™€ì„œ, ìƒˆ ì¢Œí‘œê°’(newCoordinate) ê³¼ì˜ ê±°ë¦¬ë¥¼ ì¬ì„œ 1000m ì´ìƒ ì°¨ì´ë‚  ë•Œë§Œ ê°’ì„ ë¦¬í„´(ê·¸ì™¸ì—ëŠ” nil ë¦¬í„´)

```swift
fetchCoordinate
    .flatMap { LocationService.shared.locationSubject }
    .withLatestFrom(currentCoordinate, resultSelector: { (newCoordinate, oldCoordinate) -> CLLocationCoordinate2D? in
        if oldCoordinate.latitude == 0 {
            return newCoordinate
        }
        if oldCoordinate.distance(to: newCoordinate ?? CLLocationCoordinate2D(latitude: 0, longitude: 0)) > 1000 {
            return newCoordinate
        } else {
            return nil
        }
    })
    .compactMap { $0 }
    .bind(to: currentCoordinate)
    .disposed(by: disposeBag)
```

# Alert ì¬ì‚¬ìš©

```swift
struct AlertUtil {
    static func showAlert2(
        on viewController: UIViewController,
        title: String,
        msg: String,
        cancelMsg: String,
        confirmMsg: String,
        onConfirm: @escaping () -> Void
    ) {
        let alertSheet = UIAlertController(title: title, message: msg, preferredStyle: .alert)
        alertSheet.addAction(UIAlertAction(title: cancelMsg, style: .default))
        alertSheet.addAction(UIAlertAction(title: confirmMsg, style: .destructive, handler: { _ in
            onConfirm()
        }))
        
        viewController.present(alertSheet, animated: true)
    }
}
```

