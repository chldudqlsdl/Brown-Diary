# DiffableDataSource & Realm - Delete

### viewDidAppear

- viewDidAppear ë˜ë©´ (DiffableDataSource ì„¸íŒ…ì´ ëë‚˜ë©´) Realm ë°ì´í„° ì‚­ì œ!

```swift
// BookmarkViewController
private func bind() {
    
    self.rx.viewDidAppear
        .map { _ in ()}
        .bind(to: viewModel.viewDidAppear)
        .disposed(by: disposeBag)
}

// BookmarkViewModel
init() {
    viewDidAppear
        .bind { _ in
            DataBaseManager.shared.delete()
        }
        .disposed(by: disposeBag)
}
```

# ì¦ê²¨ì°¾ê¸° A/S

### UIAlertController

- bookmarkIcon ì´ í„°ì¹˜ë˜ë©´ showAlert í•¨ìˆ˜ í˜¸ì¶œ

```swift
dataSource = UICollectionViewDiffableDataSource(collectionView: collectionView, cellProvider: { collectionView, indexPath, item in
    let cell = collectionView.dequeueReusableCell(withReuseIdentifier: "BookmarkCell", for: indexPath) as! BookmarkCell
    cell.viewModel = BookmarkCellViewModel(movieCode: item.movieCode)
    
    cell.bookmarkTapped
        .bind { [weak self] string in
            self?.showAlert(string)
        }
        .disposed(by: cell.disposebag)
        
    return cell
})

func showAlert(_ string: String) {
    
    alertSheet = UIAlertController(title: "ë”ì´ìƒ ë³´ê³ ì‹¶ì§€ ì•Šë‚˜ìš”?", message: "í•œë²ˆ ì‚­ì œí•˜ë©´ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ ğŸ¥¹", preferredStyle: .alert)
    alertSheet.addAction(UIAlertAction(title: "ì·¨ì†Œ", style: .default))
    alertSheet.addAction(UIAlertAction(title: "í™•ì¸", style: .destructive, handler: { [weak self] _ in
        Observable
            .just(string)
            .bind { string in
                self?.viewModel.deleteBookmarkedMovie.onNext(string)
            }
            .disposed(by: self?.disposeBag ?? DisposeBag())
    }))
    present(alertSheet, animated: true)
}
```

### ê°„í—ì  ì˜¤ë¥˜ ë°œìƒ

- bookmark í´ë¦­ ì‹œ ì˜í™” ì½”ë“œê°€ ì—¬ëŸ¬ë²ˆ ë„˜ì–´ì˜¤ëŠ” ê²ƒìœ¼ë¡œ ë³´ì•„ dequeueReusableCell ì˜ ì˜í–¥ìœ¼ë¡œ ì¤‘ë³µìœ¼ë¡œ ë°”ì¸ë”©ì´ ì¼ì–´ë‚˜ê³  ìˆìŒ â†’ ë¦¬ìœ ì¦ˆë  ë•Œ ë§ˆë‹¤ ë°”ì¸ë”© ì œê±°!

```swift
// BookmarkCell
override func prepareForReuse() {
    disposebag = DisposeBag()
}
```

### ë³´ê³ ì‹¶ì–´ìš” íƒ­ì—ì„œ ì œê±°í›„ ë©”ì¸íƒ­ìœ¼ë¡œ ì˜¤ë©´ ë°˜ì˜ì´ ì•ˆë¨

- ë‹¹ì—°í•¨! â†’ ë©”ì¸íƒ­ì€ viewDidLoad í˜¹ì€ ì»¬ë ‰ì…˜ë·° ì…€ ì„ íƒ ì´ë²¤íŠ¸ ì´ì™¸ëŠ” ê°€ë§Œíˆ ìˆìŒ
- viewWillAppear ì´ë²¤íŠ¸ê°€ ìƒê¸¸ ë•Œë§ˆë‹¤ ìƒˆë¡œ ë°ì´í„°ë¥¼ ë„˜ê¸°ë„ë¡ ë°”ê¿”ì£¼ê³ 
- But ë°ì´í„°ëŠ” ê·¸ëŒ€ë¡œë¼(Realm DB ë§Œ ë°”ë€ ê²ƒ) ìë™ìœ¼ë¡œ ë°ì´í„° ì†ŒìŠ¤ê°€ ë³€í•˜ì§€ ì•Šì•„ì„œ `reloadData()` ë¥¼ ë”°ë¡œ í•´ì£¼ê³  ìˆë‹¤

```swift
Observable
    .combineLatest(self.rx.viewWillAppear, viewModel.selectedDateMovieSchedule) { _ , items in
        return items
    }
    .observe(on: MainScheduler.instance)
    .subscribe { [weak self] items in
        self?.movieCollectionView.reloadData()
        UIView.transition(with: UIImageView(), duration: 0.8, options: .transitionCrossDissolve) {
            self?.setMovieSnapshot(items)
        }
    }
    .disposed(by: disposeBag)
```

ã…‡
