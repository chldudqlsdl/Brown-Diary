# 기기빌드

### 에러발생

- 지금까지 시뮬레이터로만 빌드하다가 처음으로 실기기 빌드하는 과정에서 아래와 같은 에러가 발생
- 타겟 → 라이브러리로 가보면
- RxCocoa 와 같이 RxCocoa-Dynamic 이 있는 것을 알 수 있다
    - 그럼 라이브러리가 여러 종류라는 건가?

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/2aece44c-d396-4369-b805-dee520d724c2/00349756-692e-42b3-a143-4bce7b02d780/Untitled.png)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/2aece44c-d396-4369-b805-dee520d724c2/d37d38c7-cec9-4b70-81f6-0fe5fc784cf7/Untitled.png)

### 문제해결

- 그러고보면 지금까지 spm 을 통해 라이브러리 추가할 때 무지성으로 여러개의 라이브러리를 추가해왔었고 그 과정에서 복수의 라이브러리가 매번 추가되었던 것
- Dynamic 이 적힌 라이브러리 들을 저 리스트에서 빼주면 빌드는 제대로 된다
- 참고로 시뮬레이터는 실 기기 빌드와는 많이 달라서 라이브러리가 복수로 올라가도 알아서 잘 처리하는 듯…

# Static ∙Dynamic Library

### Library?

- Xcode Target 의 일부로 빌드되지 않은 코드 및 데이터 조각
- 라이브러리와 앱의 소스코드용 파일을 병합하는 프로세스를 Link 라고 함
    - 컴파일 할 때 Link 실행
- 이 Link 방식에 따라 두가지 종류의 라이브러리로 분류된다
    - Static - 정적
    - Dynamic - 동적

### Static Library

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/2aece44c-d396-4369-b805-dee520d724c2/998f1c67-9754-4394-857b-05b7cf36e38a/Untitled.png)

- 여러 라이브러리들이 Static linker 로 병합되고
- 병합된 결과가 내가 작성한 코드와 합쳐져서 executable file 이 만들어짐
- 큰 exe file → 느린 시작 시간 + 큰 메모리 공간
- Library Update 시 다시 Link 해야 결과가 반영

### Dynamic Library

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/2aece44c-d396-4369-b805-dee520d724c2/e5a05155-4fbd-4251-b808-bb734374e5b9/Untitled.png)

- linker 로 병합되는 것은 똑같은데
- 병합된 결과의 참조만 exe file 에 포함됨 → 별도의 라이브러리 파일이 존재
- 그래서 매번 앱을 실행할 때 마다 주소 공간에 로드되고, 런치하는데 시간이 오래 걸린다

# Library 실험실

<aside>
💡 세줄요약

- 스태틱 라이브러리 : 라이브러리가 전부 실행파일에 들어갔기 때문에 빌드산출물 폴더나 앱 번들에 올라가지 않는다
- 다이내믹 라이브러리 : 앱 실행시 로드되는 방식이므로 빌드산출물 폴더와 앱 번들 폴더에 라이브러리 실행파일을 만든다
- 임베드 : 다이내믹 라이브러리와 관련된 용어로 임베드를 하지 않으면 빌드 산출물 폴더에만 올라가며 앱 번들에 포함 시키려면 임베드를 해줘야 한다 → 물론 다이내믹 라이브러리라서 빌드는 되는데 앱 실행할 때 문제가 생긴다!
</aside>

### 빌드 산출물 폴더구조

- Xcode 에서 Products 폴더에 있는 아이콘 → Show in Finder 하면 열리는 폴더가 ⇒ **빌드 산출물 폴더**
    - 스위프트 모듈 폴더 : 스위프트 컴파일러가 해당 모듈의 인터페이스를 이해하고, 다른 모듈과 상호작용 할 수 있도록 돕는다
- Products 폴더에 있는 아이콘(파일) → **앱 번들**
- 앱 번들 → 패키지 내용 보기 → exec 라고 적힌 파일 ⇒ **실행 파일**

## 실험실

### 실기기 ∙ 스태틱 라이브러리만 사용 빌드 ∙ RealmSwift(Dynamic) - Do Not Embed

- 결과 - 빌드는 됨, 앱 실행은 안됨(크래시)
    - **Dynamic Library 를 임베드를 안해줬지만, 이는 앱 실행시 로드되니까 빌드는 문제없고 실행과정에서 크래시가 나는 것으로 추측**
- 빌드 산출물 폴더 살펴보기
    - Debug-iphoneOS → PackageFrameworks
        - **RealmSwift 만 있음(폴더 안에는 실행 파일) → DynamicLibrary 는 라이브러리 실행 파일을 빌드 산출물 폴더에 만드는 구나 추측**
    - ODindi 번들 → **PackageFrameworks 가 없다!!!**
        - **Embed 는 빌드산출물 폴더에서 번들에 집어 넣는 것을 말하는 듯 보인다…**
    - 실행파일 용량 → 12.1 MB

### 실기기 ∙ 스태틱 라이브러리만 ∙ RealmSwift(Dynamic) - Embed & Sign

- 결과 - 빌드, 앱 실행 모두 정상
- 빌드 산출물 폴더
    - ODindi 번들 → Frameworks 폴더가 생겼다
        - **Debug-iphoneOS → PackageFrameworks 내의 RealmSwift 폴더의 내용이 그대로 복사되어 있다 + _CodeSignature 폴더도 함께 있는데 이것이 위의 Sign 에 의해 생긴 거 겠지!**

### 실기기 ∙ 다이내믹 라이브러리만 사용 빌드 - 모두 임베드

- 결과 - 빌드, 앱 실행 모두 정상
- 빌드 산출물 폴더
    - Debug-iphoneOS → PackageFrameworks
        - **RxBlocking-Dynamic, SnapKit-Dynamic 이 생겼다 → 다이내믹 라이브러리는 산출물 폴더에 라이브러리 실행파일을 만드는 게 확실해짐!**
    - 그리고 Debug-iphoneOS 폴더내에 RxSwift 스위프트 모듈이 사라짐…! → 이건 원인 파악이 어렵다…
    - ODindi 번들
        - **Debug-iphoneOS → PackageFrameworks 얘와 똑같은 파일 복제**
    - 실행파일 용량 → 8.3 MB
        - **실행파일에 라이브러리 코드가 포함이 안되니 용량이 줄어든 것도 확인!!**
