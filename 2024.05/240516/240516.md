# ê°„í—ì ìœ¼ë¡œ ë‚ ì§œ âˆ™ í¬ìŠ¤í„° ì•ˆë‚˜ì˜¤ë˜ ì—ëŸ¬ í”½ìŠ¤

<aside>
ğŸ’¡ ì‹œë®¬ë ˆì´í„° ì¬ìƒë²„íŠ¼ì„ ëˆŒëŸ¬ ì•±ì„ ì‹¤í–‰í•˜ë©´ ë†’ì€ í™•ë¥ (ê°€ë” ë¨)ë¡œ ë‚ ì§œ âˆ™ í¬ìŠ¤í„°ê°€ í‘œì¶œë˜ì§€ ì•ŠëŠ” ì´ìŠˆ

</aside>

### ì–´ë””ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ë‚˜

- flatMap ìœ¼ë¡œ ê°’ì´ ì „ë‹¬ì´ ì•ˆë˜ê³  ìˆìŒì„ íŒŒì•…

```swift
selectedCinema
    .do(onNext: { [weak self] _ in self?.didSelectDate.onNext(0) })
    .flatMap { cinema in
        return CinemaService.shared.fetchCinemaCalendar(cinema: cinema)
    }
    .subscribe(on: ConcurrentDispatchQueueScheduler(qos: .background))
    .do(onNext: { [weak self] _ in self?.isLoading.onNext(false)})
    .bind(to: selectedCinemaCalendar)
    .disposed(by: disposeBag)
```

### BehaviorSubject

- ê¸°ì¡´ì— `selectedCinema` ê°€ `PublishSubject` ë¡œ ì •ì˜ë˜ì–´ ìˆëŠ”ë°
- ì´ë¥¼ `BehaviorSubject` ë¡œ ë°”ê¾¸ë©´ ì—ëŸ¬ê°€ í•´ê²° ë¨
- **ê·¸ë ‡ë‹¤ë©´ Subject ê°€ ë„˜ê²¨ì£¼ëŠ” ê°’ ë³´ë‹¤ Subscribe ê°€ ëŠ¦ê²Œ ì¼ì–´ë‚œë‹¤ëŠ” ë§ì¸ë°â€¦**

```swift
var selectedCinema: PublishSubject<IndieCinema> { get }
```

### debug

- **debug ë¥¼ í•´ë³´ë©´ ì‹¤ì œë¡œ selectedCinema ì— ê°’ì´ ì „ë‹¬ë˜ëŠ” ì‹œì ì´, êµ¬ë… ë˜ëŠ” ì‹œì ë³´ë‹¤ ë¹ ë¥´ë‹¤!**
    - PublishSubject ì´ê¸° ë•Œë¬¸ì— ê°’ì´ ì „ë‹¬ë˜ê³  ë‚˜ì„œ, êµ¬ë…ì´ ë˜ë©´ ì´ì „ì— ì „ë‹¬ë¨ ê°’ì€ ì‚¬ë¼ì§„ë‹¤
    
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/2aece44c-d396-4369-b805-dee520d724c2/66d6cd53-fde1-49b1-a774-b70f5642fd0e/Untitled.png)
    
- ê·¼ë° ì½˜ì†”ì„ ë³´ë©´ 74 âˆ™ 79 ë¹¼ê³  ëª¨ë“  Observable ì€ ëŒ€ë¶€ë¶„ vm ì´ Init ë˜ìë§ˆì ê³§ë°”ë¡œ subscribed ê°€ ë¨
    - ì‹¬ì§€ì–´ viewWillAppear ë³´ë‹¤ë„ ë¹ ë¥´ê²Œ
- ì–˜ë„¤ì˜ ê³µí†µì  `.subscribe(on: ConcurrentDispatchQueueScheduler(qos: .background))` ê°€ ì‘ì„±ëœ ì½”ë“œ
    - `.subscribe(on:)` ì€ ì´ìƒì˜ ì½”ë“œì— ìˆì–´ì„œ êµ¬ë…ì´ ì§€ì •í•œ ìŠ¤ì¼€ì¤„ëŸ¬(ìŠ¤ë ˆë“œ)ì—ì„œ ëŒì•„ê°€ê²Œ ë§Œë“ ë‹¤
    - ìŠ¤ë ˆë“œë¥¼ ë°”ê¿”ì£¼ëŠ” ê³¼ì •ì´ ëª¨ì¢…ì˜ ì´ìœ ë¡œ subscribe ë¥¼ ì§€ì—°ì‹œí‚¤ê³ , êµ¬ë…ë³´ë‹¤ ê°’ ì „ë‹¬ì´ ë¨¼ì € ì¼ì–´ë‚˜ë©´ì„œ ê°’ì€ ë¬´ì‹œë˜ê³  ì´í›„ì˜ ìŠ¤íŠ¸ë¦¼ì´ ì§„í–‰ì´ ì•ˆë˜ë©´ì„œ í™”ë©´ì— ì•„ë¬´ê²ƒë„ ì•ˆëœ¨ê²Œ ë˜ëŠ” ê²ƒ

### `.subscribe(on:)`

- ì–˜ë¥¼ ì‘ì„±í•´ì£¼ë©´ ê°€ì¥ ìœ„ì— ìˆëŠ” Observable ì˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ê°€ ì§€ì •ëœ ìŠ¤ë ˆë“œì—ì„œ ì‹œì‘ëœë‹¤
    - ë³„ë‹¤ë¥¸ ì§€ì‹œê°€ ì—†ìœ¼ë©´ ì´í•˜ì˜ ëª¨ë“  ìŠ¤íŠ¸ë¦¼ì€ ì§€ì •ëœ ìŠ¤ë ˆë“œì—ì„œ ì§„í–‰ëœë‹¤
- í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œëŠ” ìŠ¤ë ˆë“œë¥¼ ë°”ê¿”ì£¼ë ¤ë‹¤ ì‹œê°„ì´ ì§€ì—°ë˜ì–´ ì•„ë¬´ ê°’ë„ ëª» ë°›ì•„ ì˜¨ë‹¤
    - ë¯¸ìŠ¤í…Œë¦¬í•œ ê±´ ê°€ë” ë  ë•ŒëŠ” ì§€ë§˜ëŒ€ë¡œ `.subscribe(on:)` ì„ ì¨ì¤˜ë„ mainThread ì—ì„œ ëŒë”ë¼
        - ê·¸ë˜ì„œ ë  ë•Œ ë³´ë¼ìƒ‰ ë©”ì‹œì§€ê°€ ë‚˜ì™”ë˜ ê²ƒ

### í•´ê²°ì±…

- `CinemaService.shared.fetchCinemaCalendar(cinema: cinema)` ì— ì§ì ‘ ì¨ì¤¬ë‹¤, ì´ ì‘ì—…ì€ ì‹œê°„ì´ ë§ì´ ì†Œëª¨ë˜ëŠ” ê²ƒì´ë‘ ìƒê´€ ì—†ê¸°ì— ì ˆëŒ€ ì—ëŸ¬ê°€ ë°œìƒí•  ì¼ì´ ì—†ë‹¤

```swift
.flatMap { cinema in
        return CinemaService.shared.fetchCinemaCalendar(cinema: cinema)
            .subscribe(on: ConcurrentDispatchQueueScheduler(qos: .background))
    }
```

ã…‡
