# ë°”ì¸ë”© ë°©ë²• : Subject

### MenuListViewModel Setting

### ê°’ì„ ë°”ì¸ë”© í•˜ê³  ì‹¶ì–´!

- ì ì´ë ‡ê²Œê¹Œì§€ëŠ” ì‰½ê³ 

```swift
struct MenuListViewModel {
    
    var totalPrice: Observable<Int> = Observable.just(10000)
    
}

class MenuViewController: UIViewController {
    // MARK: - Life Cycle
    
    var viewModel = MenuListViewModel()
    var disposeBag = DisposeBag()

    override func viewDidLoad() {
        super.viewDidLoad()
        
        itemCountLabel.text = "\(viewModel.itemsCount)"
        viewModel.totalPrice
            .map({ $0.currencyKR() })
            .subscribe(onNext: { self.totalPrice.text = $0 })
            .disposed(by: disposeBag)
    }
}
```

### Observable ì— ê°’ì„ ë„˜ê²¨ì¤„ ìˆ˜ ìˆì–´ì•¼ ì§„ì •í•œ ë°”ì¸ë”©ì¸ë””â€¦?

### Subject  - Observable âˆ™ Observer ì—­í• ì„ ë™ì‹œì—â€¦ ğŸ‘

```swift
struct MenuListViewModel {
    
    var totalPrice: PublishSubject<Int> = PublishSubject()
}

// subscribe
viewModel.totalPrice
    .map({ $0.currencyKR() })
    .subscribe(onNext: { self.totalPrice.text = $0 })
    .disposed(by: disposeBag)

// onNext
@IBAction func onOrder(_ sender: UIButton) {
    viewModel.totalPrice.onNext(100)
}
```

- Observable ê³¼ ë¹„êµ : ì›ë˜ onNext ë©”ì„œë“œëŠ” Observer ì˜ ë©”ì„œë“œì´ë©°, Observer ì—ê²Œ ê°’ì„ ì „ë‹¬ë°›ê²Œ í•¨

```swift
let observable = Observable<Int>.create { observer in
    observer.onNext(1)
    observer.onNext(2)
    observer.onCompleted()
    return Disposables.create()
}
```

### Subject ì¹œêµ¬ë“¤

- BehaviorSubject : ê¸°ë³¸ê°’ì„ ê°€ì§€ê³  ì‹œì‘
- AsyncSubject : Completed ë˜ëŠ” ì‹œì ì— ë§ˆì§€ë§‰ ê°’ ë„˜ê¹€
- ReplaySubject : ë’¤ ëŠ¦ê²Œ êµ¬ë…í•´ë„ ì§€ê¸ˆê¹Œì§€ ë‚ ë¦° ê°’ ë‹¤ ë„˜ê²¨ì¤Œ

### ìœ„ì²˜ëŸ¼ í•˜ë©´ ê³„ì† 100ë§Œ ë„˜ì–´ê°€ëŠ”ë°, ì–´ë–»ê²Œ +=100 ì„ í•˜ì§€?

- { $0 + $1 } ì¶•ì•½í•˜ë©´ â†’ +

```swift
viewModel.totalPrice
    .scan(0, accumulator: +)
    .map({ $0.currencyKR() })
    .subscribe(onNext: { self.totalPrice.text = $0 })
    .disposed(by: disposeBag)
```

# ë°”ì¸ë”©í•˜ê¸°

### Observable

- menus ëŠ” ì²˜ìŒì— ë°›ì€ ê·¸ëŒ€ë¡œ!
- ê³ ì°¨í•¨ìˆ˜ ì˜ ì“°ë‹ˆ ì½”ë“œê°€ ì˜ˆìˆ ì´ë„¤â€¦

```swift
struct MenuListViewModel {
    
    let menus : [Menu] = [
        Menu(name: "íŠ€ê¹€1", price: 500, count: 5),
        Menu(name: "íŠ€ê¹€1", price: 500, count: 2),
    ]
    
    lazy var menuObservable = Observable.just(menus)
        
    lazy var totalPrice = menuObservable
        .map { menus in
        menus.map{ $0.price * $0.count}.reduce(0, +)}
}

// MenuViewController

viewModel.totalPrice
    .map({ $0.currencyKR() })
    .subscribe(onNext: { self.totalPrice.text = $0 })
    .disposed(by: disposeBag)
```

### Subject ë¡œ ë°”ê¾¸ê¸°

```swift
struct MenuListViewModel {
    
    lazy var menuObservable = PublishSubject<[Menu]>()
    
    init() {
        let menus : [Menu] = [
            Menu(name: "íŠ€ê¹€1", price: 500, count: 0),
            Menu(name: "íŠ€ê¹€1", price: 500, count: 0),
        ]
        
        menuObservable.onNext(menus)
    }
}
```

### BehaviorSubject ë¡œ êµì²´

- PublishSubject ëŠ” ì´ˆê¸°ê°’ì„ ë°›ê³  ë‚œë’¤ ì„œë¸ŒìŠ¤í¬ë¼ì´ë¸Œ í•˜ë©´ ê·¸ ì´ˆê¸°ê°’ì€ ê¹Œë¨¹ëŠ”ë‹¤
    - ReactiveX Subject ì°¸ì¡°

```swift
lazy var menuObeservable = BehaviorSubject(value: menus)

```

# RxCocoa

### bind

- ì–˜ë¥¼

```swift
viewModel.totalPrice
    .map({$0.currencyKR()})
    .subscribe(onNext: { self.totalPrice.text = $0 })
    .disposed(by: disposeBag)
```

- ì´ë ‡ê²Œ
    - self ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ìˆœí™˜ì°¸ì¡° ìš°ë ¤ë„ ì—†ìŒ

```swift
viewModel.totalPrice
    .map({$0.currencyKR()})
    .bind(to: totalPrice.rx.text)
    .disposed(by: disposeBag)
```

### tableviewDataSourceBinding

- ê¸°ì¡´ dataSource ì—°ê²°ì€ ëŠì–´ì¤˜ì•¼ í•¨

```swift
viewModel.menuObeservable
    .bind(to: tableView.rx.items(cellIdentifier: cellIdentifier, cellType: MenuItemTableViewCell.self)) { index, item, cell in
        
        cell.title.text = item.name
        cell.price.text = "\(item.price)"
        cell.count.text = "\(item.count)"

    }
```

- í•¨ìˆ˜ ëª¨ì–‘ì´ íŠ¹ì´í•œë° â†’ curriedArgument ê°€ í›„í–‰í´ë¡œì € í˜•íƒœê°€ ëœ ê²ƒ

```swift
.bind(to: { <#BehaviorSubject<[Menu]>#> in
                <#code#>
            }, curriedArgument: <#T##R1#>)
```

- **ì»¤ë§í•¨ìˆ˜ : ì²«ë²ˆì§¸ ì¸ìë¥¼ ë°›ì•„ì„œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ë†“ê³ , ë‘ë²ˆì§¸ ì¸ìë¥¼ ê·¸ í•¨ìˆ˜ì— ë„£ëŠ”ë‹¤**

```swift
public func bind<R1, R2>(to binder: (Self) -> (R1) -> R2, curriedArgument: R1) -> R2 {
         return binder(self)(curriedArgument)
    }

```

# ê°’ì„ ë°”ê¿”ë´…ì‹œë‹¤

### ì„±ê³µ

```swift
    @IBAction func onOrder(_ sender: Any) {
        viewModel.menuObeservable.onNext([
            Menu(name: "ì•¼ì±„íŠ€ê¹€", price: 500, count: 1)
        ])
    }
```


