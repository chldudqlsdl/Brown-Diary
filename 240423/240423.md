# **61. Dynamic Cell Sizing & Bug Fix**

<aside>
ğŸ’¡ **íŠ¸ìœ— ë‚ ë¦¬ëŠ” í™”ë©´ ì˜ë¦¬ëŠ” ë¬¸ì œ âˆ™ í”¼ë“œì˜ íŠ¸ìœ— ì…€ ë‹¤ì´ë‚´ë¯¹ ì‚¬ì´ì§•**

</aside>

### UploadTweetController TextView ì˜ë¦¬ëŠ” ë¬¸ì œ

- TextView ê°€ ë“¤ì–´ê°€ëŠ” StackView ì— alignment ì„¤ì •í•´ì£¼ë©´ ë¨
    - default alignment ëŠ” fillì¸ë° ì–˜ëŠ” ë‚´ë¶€ìš”ì†Œì˜ í¬ê¸°ê°€ ì•„ë‹ˆê³  ìŠ¤íƒë·°ì˜ í¬ê¸°ë¥¼ ë”°ë¼ê°€ê¸° ë•Œë¬¸ì— ì´ë¥¼ ìˆ˜ì •í•´ì¤˜ì•¼ í•œë‹¤

```swift
private lazy var stackView = UIStackView().then {
    $0.addArrangedSubview(profileImageView)
    $0.addArrangedSubview(captionTextView)
    $0.axis = .horizontal
    $0.spacing = 12
    $0.alignment = .top
}
```

### TweetCell Dynamic Sizing

- UILabel() ì— ê°€ë¡œ ê¸¸ì´ë¥¼ ë„£ê³  ì˜¤í† ë ˆì´ì•„ì›ƒì„ ì„¤ì •, ì‹¤ì œ í…ìŠ¤íŠ¸ë¥¼ ë„£ì–´ë³´ê³  ë‚˜ì˜¤ëŠ” ë†’ì´ë¥¼ ë¦¬í„´
- ì˜ˆì‹œ ì½”ë“œì— í‹€ë¦°ì ì´ ìˆì–´ì„œ ë‹¤ì†Œ ìˆ˜ì •í•¨

```swift
// TweetViewModel
func size(forWidth width: CGFloat, withFontSize size: CGFloat) -> CGSize {
    let measurementLabel = UILabel()
    measurementLabel.text = tweet.caption
    measurementLabel.font = UIFont.systemFont(ofSize: size)
    measurementLabel.numberOfLines = 0
    measurementLabel.lineBreakMode = .byWordWrapping
    measurementLabel.translatesAutoresizingMaskIntoConstraints = false
    measurementLabel.widthAnchor.constraint(equalToConstant: width).isActive = true
    return measurementLabel.systemLayoutSizeFitting(UIView.layoutFittingCompressedSize)
}

// FeedController
extension FeedController: UICollectionViewDelegateFlowLayout {
    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath: IndexPath) -> CGSize {
        let viewModel = TweetViewModel(tweet: tweets[indexPath.row])
        let height = viewModel.size(forWidth: view.frame.width - 80, withFontSize: 14).height
        return CGSize(width: view.frame.width, height: height + 80)
    }
}
```

# **62. Getting Started With Replies**

<aside>
ğŸ’¡ UploadReplyController ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì•¼ í•˜ë‚˜ í–ˆì§€ë§Œ, Enum ì„ í™œìš©í•´ì„œ ì´ë¯¸ ìˆëŠ” UploadTweetController ë¥¼ ë¶„ê¸°ì‹œí‚¤ëŠ” ë°©ë²• ì‚¬ìš©! ğŸ‘

</aside>

### UploadTweetConfiguration & UploadTweetViewModel + ì—°ê´€ê°’ ğŸ‘

- **ì¼€ì´ìŠ¤ë¥¼ ë‘˜ë¡œ ë‚˜ëˆ„ê³  replyëŠ” ì—°ê´€ê°’ì´ ìˆëŠ” ì¼€ì´ìŠ¤ë¡œ!!!**

```swift
enum UploadTweetConfiguration {
    case tweet
    case reply(Tweet)
}

class UploadTweetViewModel {
    let actionButtonTitle: String
    let placeholderText: String
    var shouldShowReplyLabel: Bool
    var replyText: String?
    
    init(config: UploadTweetConfiguration) {
        switch config {
        case .tweet:
            actionButtonTitle = "Tweet"
            placeholderText = "What's happening"
            shouldShowReplyLabel = false
        case .reply(let tweet):
            actionButtonTitle = "Reply"
            placeholderText = "Tweet your reply"
            shouldShowReplyLabel = true
            replyText = "Replying to @\(tweet.user.username)"
        }
    }
}
```

### UploadTweetController

- ì†ì„±ìœ¼ë¡œ Enum UploadTweetConfiguration ë¥¼ ë°›ì•„ì„œ ë¶„ê¸°ì‹œí‚¬ ì‘ì •

```swift
class UploadTweetController: UIViewController {
    private let user: User
    private let config: UploadTweetConfiguration
    private lazy var viewModel = UploadTweetViewModel(config: config)
}
```

### TweetCell (ReplyButton ì´ ìˆëŠ” ê³³)

```swift
protocol TweetCellDelegate: AnyObject {
    func handleProfileImageTapped(_ cell: TweetCell)
    func handleCommentTapped(_ cell: TweetCell)
}

@objc func handleCommentTapped() {
    delegate?.handleCommentTapped(self)
}
```

### FeedController(delegate)

- FullScreen ì„ ì“°ë©´ì„œ ë„¤ë¹„ê²Œì´ì…˜ë°”ë¥¼ ìœ ì§€í•˜ë ¤ë©´, ë·°ì»¨ì„ ì–¹ì€ ìƒˆ ë„¤ë¹„ê²Œì´ì…˜ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“¤ê³  ê±”ë¥¼ Present

```swift
func handleCommentTapped(_ cell: TweetCell) {
    guard let tweet = cell.tweet else { return }
    let controller = UploadTweetController(user: tweet.user, config: .reply(tweet))
    let nav = UINavigationController(rootViewController: controller)
    nav.modalPresentationStyle = .fullScreen
    present(nav, animated: true)
}
```

# **63. Use ViewModel To Populate Data**

<aside>
ğŸ’¡ **reply í•  ë•ŒëŠ” replyLabel ì„ ë³´ì—¬ì£¼ê³ , tweet í•  ë•ŒëŠ” replyLabel ì„ ìˆ¨ê²¨ì•¼ í•¨**

</aside>

### StackView

- replyLabel ì´ í¬í•¨ëœ StackView ë¥¼ ë§Œë“¤ì–´ì£¼ë©´ tweet í•  ë•Œ ì´ë¥¼ hidden ì‹œì¼œì¤˜ë„ UIê°€ ì¡í˜

### isHidden

- ì–´ë–»ê²Œ Label ì„ ì—†ì• ì•¼ í•˜ë‚˜ ê±±ì •í–ˆëŠ”ë° ìƒê°ë³´ë‹¤ ë§¤ìš° ê°„ë‹¨

```swift
// UploadTweetController

actionButton.setTitle(viewModel.actionButtonTitle, for: .normal)
captionTextView.placeholderLabel.text = viewModel.placeholderText
**replyLabel.isHidden = !viewModel.shouldShowReplyLabel**
guard let replyText = viewModel.replyText else { return }
replyLabel.text = replyText
```

d
