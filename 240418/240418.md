# **28. Adding Caption TextView**

### UITextView ëŠ” placeholder ê°€ ì—†ì–´ì„œ ì§ì ‘ ë§Œë“¤ì–´ì£¼ì

- ì´ ë¶€ë¶„ ì½”ë“œ ê¹”ë” `placeholderLabel.isHidden = !text.isEmpty`
- NotificationCenter ì‚¬ìš©

```swift
class CaptionTextView: UITextView {
    
    let placeholderLabel = UILabel().then {
        $0.font = UIFont.systemFont(ofSize: 16)
        $0.textColor = .darkGray
        $0.text = "What's happening?"
    }
        
    override init(frame: CGRect, textContainer: NSTextContainer?) {
        super.init(frame: frame, textContainer: textContainer)
        
        backgroundColor = .systemBackground
        font = UIFont.systemFont(ofSize: 16)
        isScrollEnabled = false
        
        self.snp.makeConstraints {
            $0.height.equalTo(300)
        }
        
        addSubview(placeholderLabel)
        placeholderLabel.snp.makeConstraints {
            $0.top.equalToSuperview().inset(8)
            $0.leading.equalToSuperview().inset(4)
        }
        
        NotificationCenter.default.addObserver(self, selector: #selector(handleTextInputChange), name: UITextView.textDidChangeNotification, object: nil)
    }
    
    required init?(coder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
    
    @objc func handleTextInputChange() {
        placeholderLabel.isHidden = !text.isEmpty
    }
}
```

# **29. Uploading Tweet To Firebase**

### API - TweetService

- `childByAutoId()` ì´ ë¶€ë¶„ì´ íŠ¹ì´í•¨

```swift
struct TweetService {
    static let shared = TweetService()
    private init() {}
    
    func uploadTweet(caption: String, completion: @escaping ( Error?, DatabaseReference) -> Void) {
        guard let uid = Auth.auth().currentUser?.uid else { return }
        
        let values = ["uid": uid, 
                      "timestamp": Int(NSDate().timeIntervalSince1970),
                      "likes": 0,
                      "retweets": 0,
                      "caption": caption] as [String : Any]
        
        REF_TWEETS.childByAutoId().updateChildValues(values, withCompletionBlock: completion)
    }
}
```

# **30. Fetch Tweets From Firebase & Create Tweet Object**

### Observe

- **observe ëŠ” ì‹¤ì œë¡œ observing í•˜ê³  ìˆë‹¤ â†’ RxSwift ëŠë‚Œâ€¦?**
- .childAdded ëŠ” Added ë¥¼ ê°ì§€í•´ì„œ true ë©´ í•¨ìˆ˜ë¥¼ ì‹¤í–‰â€¦

```swift
struct TweetService {
    
    func fetchTweets(completion: @escaping ([Tweet]) -> Void) {
        var tweets : [Tweet] = []
        REF_TWEETS.observe(.childAdded) { snapshot in
            guard let dictionary = snapshot.value as? [String: Any] else { return }
            let tweetID = snapshot.key
            let tweet = Tweet(tweetID: tweetID, dictionary: dictionary)
            tweets.append(tweet)
            completion(tweets)
        }
    }
}
```

### Tweet Model

```swift
struct Tweet {
    let caption: String
    let tweetID: String
    let uid: String
    let likes: Int
    let retweetCount: Int
    let timestamp: Date?
    
    init(tweetID: String, dictionary: [String: Any]) {
        self.tweetID = tweetID
        
        self.caption = dictionary["caption"] as? String ?? ""
        self.uid = dictionary["uid"] as? String ?? ""
        self.likes = dictionary["likes"] as? Int ?? 0
        self.retweetCount = dictionary["caption"] as? Int ?? 0
        
        if let timestamp = dictionary["timestamp"] as? Double {
            self.timestamp = Date(timeIntervalSince1970: timestamp)
        } else {
            timestamp = nil
        }
    }
}
```

# **31. Setup CollectionView For Feed**

### UIViewController ê°€ ì•„ë‹ˆë¼ UICollectionViewController

- nil ë¡œ init í•˜ë©´ ì—ëŸ¬ ë°œìƒ
    - UICollectionView must be initialized with a non-nil layout parameter

```swift
// MainTabController

let feed = FeedController(collectionViewLayout: UICollectionViewFlowLayout())
```

- **UICollecionViewController ëŠ” ì›ë˜ë¶€í„° CollectionView ë¥¼ ê°€ì§€ê³  ìˆê³ , ì–˜ëŠ” dataSource ì™€ Delegate ì™€ ì—°ê²°ë˜ì–´ ìˆì–´ì„œ ë”°ë¡œ ì—°ê²°í•´ì¤„ í•„ìš”ê°€ ì—†ë‹¤**

# **33. Populate Feed With Tweets**

### reloadData( )

- ì´ê²Œ ì•ˆ ë¨¹íŒë‹¤ â†’ ì™œëƒë©´ tweets ì„ ë°›ì•„ì˜¤ëŠ”ë° ì‹œê°„ì´ ê±¸ë¦¬ê¸° ë•Œë¬¸

```swift
extension FeedController {
    override func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {
        return tweets.count
    }
```

- í•´ê²°ë°©ë²•

```swift
private var tweets: [Tweet] = [] {
    didSet { collectionView.reloadData() }
}
```

# **36. Tweet View Model**

### ViewModel ë¡œ View ì˜ ë¶€ë‹´ì„ ëœì–´ì£¼ì–´ ì¢€ë¹„ë¥¼ ë§Œë“¤ì–´ ë²„ë¦¬ì ğŸ§Ÿ
